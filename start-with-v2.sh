#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ NumerOM —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–∏—Å—Ç–µ–º—ã –æ–±—É—á–µ–Ω–∏—è V2..."

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose down

# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up --build -d

echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤..."
sleep 15

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤..."

# –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ IP –∞–¥—Ä–µ—Å–∞
LOCAL_IP=$(ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1' | head -1 | sed 's/inet //' | sed 's/addr://')

# –ü—Ä–æ–≤–µ—Ä–∫–∞ backend
if curl -s http://localhost:8001/docs > /dev/null; then
    echo "‚úÖ Backend –¥–æ—Å—Ç—É–ø–µ–Ω: http://localhost:8001"
    echo "   üåê –°–µ—Ç—å: http://$LOCAL_IP:8001"
else
    echo "‚ùå Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ frontend
if curl -s http://localhost:3000 > /dev/null; then
    echo "‚úÖ Frontend –¥–æ—Å—Ç—É–ø–µ–Ω: http://localhost:3000"
    echo "   üåê –°–µ—Ç—å: http://$LOCAL_IP:3000"
else
    echo "‚ùå Frontend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
fi

echo ""
echo "üéØ –°–µ—Ä–≤–∏—Å—ã –≥–æ—Ç–æ–≤—ã!"
echo ""
echo "üì± –û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç:"
echo "   ‚Ä¢ –õ–æ–∫–∞–ª—å–Ω–æ: http://localhost:3000"
echo "   ‚Ä¢ –í —Å–µ—Ç–∏: http://$LOCAL_IP:3000"
echo ""
echo "üîß Backend API:"
echo "   ‚Ä¢ –õ–æ–∫–∞–ª—å–Ω–æ: http://localhost:8001"
echo "   ‚Ä¢ –í —Å–µ—Ç–∏: http://$LOCAL_IP:8001"
echo ""
echo "üìä MongoDB: localhost:27017"
echo ""
echo "üéì –°–∏—Å—Ç–µ–º–∞ –æ–±—É—á–µ–Ω–∏—è V2:"
echo "   ‚Ä¢ –î–∞—à–±–æ—Ä–¥: http://$LOCAL_IP:3000/dashboard/learning-v2"
echo "   ‚Ä¢ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å V2: http://$LOCAL_IP:3000/dashboard/admin (–≤–∫–ª–∞–¥–∫–∞ '–£—Ä–æ–∫–∏ V2')"
echo "   ‚Ä¢ –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∞–¥–º–∏–Ω V2: http://$LOCAL_IP:3000/admin-v2"
echo ""
echo "üí° –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:"
echo "   Email: dmitrii.malahov@gmail.com"
echo "   –ü–∞—Ä–æ–ª—å: 756bvy67H"
echo ""
echo "üìù –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤ V2:"
echo "   1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"
echo "   2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É '–£—Ä–æ–∫–∏ V2'"
echo "   3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã —É—Ä–æ–∫–æ–≤ –∏–∑ –ø–∞–ø–∫–∏ '—Ñ–∞–∏ÃÜ–ª—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞/NumerOM –∑–∞–ø—É—Å–∫ –∫—É—Ä—Å–∞'"
