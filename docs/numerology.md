# Классическая нумерология

## Обзор

Модуль классической нумерологии (`numerology.py`) предоставляет расчеты персональных чисел, квадрата Пифагора и анализа совместимости на основе даты рождения.

## Основные функции

### 1. Персональные числа

#### calculate_personal_numbers(birth_date: str)
Вычисляет все основные персональные числа человека.

**Параметры:**
- `birth_date` (str): Дата рождения в формате "DD.MM.YYYY"

**Возвращает:**
```python
{
    'soul_number': int,        # ЧД - Число души
    'mind_number': int,        # ЧУ - Число ума  
    'destiny_number': int,     # ЧС - Число судьбы
    'helping_mind_number': int, # ЧУ* - Помогающее число ума
    'wisdom_number': int,      # ЧМ - Число мудрости
    'ruling_number': int,      # ПЧ - Правящее число
    'planetary_strength': dict, # Сила планет
    'birth_weekday': str,      # День недели рождения
    'calculation_details': dict # Детали расчета
}
```

**Пример использования:**
```python
from numerology import calculate_personal_numbers

result = calculate_personal_numbers("15.08.1985")
print(f"Число души: {result['soul_number']}")
print(f"Число судьбы: {result['destiny_number']}")
```

#### Детальные расчеты чисел

##### Число души (ЧД)
```python
def calculate_soul_number(day: int) -> int:
    """
    Рассчитывает число души из дня рождения
    Пример: родился 15 числа → 1+5 = 6
    """
    return reduce_to_single_digit(day)
```

##### Число ума (ЧУ)
```python
def calculate_mind_number(month: int) -> int:
    """
    Рассчитывает число ума из месяца рождения
    Пример: родился в августе (8) → 8
    """
    return reduce_to_single_digit(month)
```

##### Число судьбы (ЧС)
```python
def calculate_destiny_number(day: int, month: int, year: int) -> int:
    """
    Рассчитывает число судьбы как сумму всех цифр даты
    Пример: 15.08.1985 → 1+5+0+8+1+9+8+5 = 37 → 3+7 = 1
    """
    total = day + month + year
    return reduce_to_single_digit_always(total)
```

##### Правящее число (ПЧ)
```python
def calculate_ruling_number(day: int, month: int, year: int) -> int:
    """
    Особый расчет с сохранением мастер-чисел 11 и 22
    Сумма всех цифр даты рождения
    """
    all_digits = [int(d) for d in str(day) + str(month) + str(year)]
    total = sum(all_digits)
    
    # Проверка мастер-чисел на каждом этапе
    if total == 11 or total == 22:
        return total
    
    while total > 9:
        total = sum(int(digit) for digit in str(total))
        if total == 11 or total == 22:
            return total
    
    return total
```

### 2. Планетарная сила

#### calculate_planetary_strength(day: int, month: int, year: int)
Рассчитывает силу планет по специальной формуле.

**Формула:** `день+месяц (как число) * год = результат`

**Пример:** 
- Дата: 10.01.1982
- Расчет: 1001 * 1982 = 1983982
- Цифры результата распределяются по планетам начиная с дня недели рождения

**Соответствие планет:**
```python
planet_names = [
    'Солнце',    # 0 - Воскресенье
    'Луна',      # 1 - Понедельник  
    'Марс',      # 2 - Вторник
    'Меркурий',  # 3 - Среда
    'Юпитер',    # 4 - Четверг
    'Венера',    # 5 - Пятница
    'Сатурн'     # 6 - Суббота
]
```

**Возвращает:**
```python
{
    'strength': {
        'Солнце': int,
        'Луна': int,
        'Марс': int,
        'Меркурий': int,
        'Юпитер': int,
        'Венера': int,
        'Сатурн': int
    },
    'weekday_map': dict,           # Соответствие планет дням недели
    'calculation_number': int,     # Число расчета
    'birth_weekday': str,         # День недели рождения
    'start_planet_index': int     # Индекс начальной планеты
}
```

### 3. Квадрат Пифагора

#### create_pythagorean_square(day: int, month: int, year: int)
Создает классический квадрат Пифагора с 4 дополнительными числами.

**Алгоритм расчета:**

1. **Исходные числа:** Дата рождения (DD.MM.YYYY)
2. **Дополнительные числа:**
   - А1: Сумма всех цифр даты
   - А2: Сумма цифр числа А1
   - А3: А1 - 2 * первая_цифра_дня
   - А4: Сумма цифр числа А3

**Пример для 15.08.1985:**
```python
# Исходные цифры: 1,5,0,8,1,9,8,5
А1 = 1+5+0+8+1+9+8+5 = 37
А2 = 3+7 = 10 → 1+0 = 1  
А3 = 37 - 2*1 = 35
А4 = 3+5 = 8

# Все рабочие цифры: 1,5,0,8,1,9,8,5,3,7,1,3,5,8
# Распределение по квадрату:
# 1: 1,1,1 (три единицы)
# 3: 3,3 (две тройки)
# 5: 5,5,5 (три пятерки)
# 7: 7 (одна семерка)
# 8: 8,8,8 (три восьмерки)
# 9: 9 (одна девятка)
```

**Структура квадрата:**
```
| 1 | 2 | 3 |
|---|---|---|
| 4 | 5 | 6 |
| 7 | 8 | 9 |
```

**Возвращает:**
```python
{
    "square": [                    # 3x3 матрица со строками цифр
        ["111", "", "33"],         # Строка 1
        ["", "555", ""],           # Строка 2  
        ["7", "888", "9"]          # Строка 3
    ],
    "horizontal_sums": [6, 3, 4],  # Суммы по строкам (материальная сфера)
    "vertical_sums": [4, 6, 3],    # Суммы по столбцам (духовная сфера)
    "diagonal_sums": [7, 6],       # Суммы по диагоналям (баланс)
    "additional_numbers": [37, 1, 35, 8],  # А1, А2, А3, А4
    "number_positions": {          # Позиции цифр в квадрате
        "1": [0, 0], "2": [1, 0], "3": [2, 0],
        "4": [0, 1], "5": [1, 1], "6": [2, 1],
        "7": [0, 2], "8": [1, 2], "9": [2, 2]
    }
}
```

### 4. Совместимость

#### calculate_compatibility(birth_date1: str, birth_date2: str)
Анализирует совместимость двух людей по их датам рождения.

**Алгоритм:**
1. Вычисляет числа жизненного пути для обоих партнеров
2. Определяет совместимость на основе разности чисел
3. Возвращает оценку от 1 до 10

**Пример:**
```python
result = calculate_compatibility("15.08.1985", "22.03.1990")

# Результат:
{
    "person1_life_path": 5,
    "person2_life_path": 7, 
    "compatibility_score": 8,
    "description": "Совместимость 8/10"
}
```

### 5. Нумерология имени

#### calculate_name_numerology(full_name: str)
Рассчитывает нумерологическое значение имени.

**Соответствие букв числам (русский алфавит):**
```python
letter_values = {
    'А': 1, 'Б': 2, 'В': 3, 'Г': 4, 'Д': 5, 'Е': 6, 'Ё': 6,
    'Ж': 7, 'З': 8, 'И': 9, 'Й': 1, 'К': 2, 'Л': 3, 'М': 4,
    'Н': 5, 'О': 6, 'П': 7, 'Р': 8, 'С': 9, 'Т': 1, 'У': 2,
    'Ф': 3, 'Х': 4, 'Ц': 5, 'Ч': 6, 'Ш': 7, 'Щ': 8, 'Ъ': 9,
    'Ы': 1, 'Ь': 2, 'Э': 3, 'Ю': 4, 'Я': 5
}
```

**Возвращает:**
```python
{
    "full_name": "Елена Петрова",
    "first_name": "Елена",
    "last_name": "Петрова", 
    "first_name_number": 5,
    "last_name_number": 3,
    "total_name_number": 8,
    "first_name_interpretation": "Свобода, приключения, любознательность",
    "last_name_interpretation": "Творчество, общительность, оптимизм",
    "total_interpretation": "Материальный успех, власть, амбиции"
}
```

### 6. Дополнительные расчеты

#### Нумерология автомобильного номера
```python
def calculate_car_number_numerology(car_number: str) -> Dict[str, Any]:
    """
    Анализирует номер автомобиля (до 13 символов)
    Поддерживает русские и латинские буквы
    """
```

#### Нумерология адреса
```python
def calculate_address_numerology(street: str = None, 
                               house_number: str = None,
                               apartment_number: str = None, 
                               postal_code: str = None) -> Dict[str, Any]:
    """
    Анализирует нумерологию места проживания
    """
```

#### Групповая совместимость
```python
def calculate_group_compatibility(main_person_birth_date: str, 
                                people_data: List[Dict[str, str]]) -> Dict[str, Any]:
    """
    Анализирует совместимость одного человека с группой (до 5 человек)
    """
```

## API Endpoints

### 1. Персональные числа
```http
POST /api/numerology/personal-numbers
Authorization: Bearer <token>
Content-Type: application/json

{
  "birth_date": "15.08.1985"
}
```

**Ответ:**
```json
{
  "soul_number": 6,
  "mind_number": 8,
  "destiny_number": 1,
  "ruling_number": 1,
  "planetary_strength": {
    "Солнце": 1,
    "Луна": 9,
    "Марс": 8,
    "Меркурий": 3,
    "Юпитер": 9,
    "Венера": 8,
    "Сатурн": 2
  },
  "birth_weekday": "четверг"
}
```

### 2. Квадрат Пифагора
```http
POST /api/numerology/pythagorean-square
Authorization: Bearer <token>
Content-Type: application/json

{
  "birth_date": "15.08.1985"
}
```

**Ответ:**
```json
{
  "square": [
    ["111", "", "33"],
    ["", "555", ""],
    ["7", "888", "9"]
  ],
  "horizontal_sums": [6, 3, 4],
  "vertical_sums": [4, 6, 3],
  "diagonal_sums": [7, 6],
  "additional_numbers": [37, 1, 35, 8]
}
```

### 3. Совместимость
```http
POST /api/numerology/compatibility
Authorization: Bearer <token>
Content-Type: application/json

{
  "person1_birth_date": "15.08.1985",
  "person2_birth_date": "22.03.1990",
  "person1_name": "Анна",
  "person2_name": "Михаил"
}
```

### 4. Нумерология имени
```http
POST /api/numerology/name-number
Authorization: Bearer <token>
Content-Type: application/json

{
  "name": "Елена Петрова"
}
```

## Стоимость в кредитах

| Операция | Стоимость |
|----------|-----------|
| Персональные числа | 1 кредит |
| Квадрат Пифагора | 1 кредит |
| Нумерология имени | 1 кредит |
| Совместимость пары | 1 кредит |
| Групповая совместимость | 5 кредитов |

## Интерпретации чисел

### Значения чисел 1-9

#### 1 - Лидер
- **Качества:** Независимость, лидерство, новаторство
- **Сфера:** Власть, управление, предпринимательство
- **Планета:** Солнце
- **Цвет:** Красный, золотой

#### 2 - Дипломат  
- **Качества:** Сотрудничество, дипломатия, чувствительность
- **Сфера:** Отношения, партнерство, служение
- **Планета:** Луна
- **Цвет:** Серебристый, белый

#### 3 - Творец
- **Качества:** Творчество, общительность, оптимизм
- **Сфера:** Искусство, общение, развлечения
- **Планета:** Юпитер  
- **Цвет:** Желтый, золотой

#### 4 - Строитель
- **Качества:** Стабильность, практичность, трудолюбие
- **Сфера:** Строительство, организация, системность
- **Планета:** Раху
- **Цвет:** Коричневый, зеленый

#### 5 - Исследователь
- **Качества:** Свобода, приключения, любознательность  
- **Сфера:** Путешествия, коммуникации, торговля
- **Планета:** Меркурий
- **Цвет:** Серый, металлический

#### 6 - Воспитатель
- **Качества:** Забота, ответственность, гармония
- **Сфера:** Семья, воспитание, искусство
- **Планета:** Венера
- **Цвет:** Розовый, голубой

#### 7 - Мистик
- **Качества:** Духовность, анализ, мудрость
- **Сфера:** Исследования, духовность, уединение
- **Планета:** Кету
- **Цвет:** Фиолетовый, индиго

#### 8 - Материалист
- **Качества:** Материальный успех, власть, амбиции
- **Сфера:** Бизнес, финансы, управление
- **Планета:** Сатурн
- **Цвет:** Черный, темно-синий

#### 9 - Гуманист
- **Качества:** Служение, сострадание, универсальность
- **Сфера:** Гуманитарная помощь, завершение проектов
- **Планета:** Марс
- **Цвет:** Красный, алый

### Мастер-числа

#### 11 - Вдохновитель
- **Качества:** Интуиция, вдохновение, духовное лидерство
- **Особенность:** Высокая чувствительность, психические способности

#### 22 - Мастер-строитель
- **Качества:** Материализация больших идей, мастерство
- **Особенность:** Способность воплощать духовные идеи в материальном мире

#### 33 - Учитель
- **Качества:** Высшее служение, исцеление, учительство
- **Особенность:** Редко встречается, высокая духовная миссия

## Примеры использования

### Полный анализ личности
```python
from numerology import calculate_personal_numbers, create_pythagorean_square

# Расчет всех чисел
birth_date = "15.08.1985"
personal = calculate_personal_numbers(birth_date)
day, month, year = 15, 8, 1985
square = create_pythagorean_square(day, month, year)

print(f"Число души: {personal['soul_number']} (Планета: Венера)")
print(f"Число судьбы: {personal['destiny_number']} (Планета: Солнце)")
print(f"Сильные планеты: {[k for k, v in personal['planetary_strength'].items() if v >= 3]}")
```

### Анализ совместимости семьи
```python
from numerology import calculate_group_compatibility

family_data = [
    {"name": "Супруг", "birth_date": "22.03.1990"},
    {"name": "Дочь", "birth_date": "15.12.2015"},
    {"name": "Сын", "birth_date": "08.07.2018"}
]

compatibility = calculate_group_compatibility("15.08.1985", family_data)
print(f"Средняя совместимость семьи: {compatibility['average_compatibility']:.1f}/10")
```

## Ограничения и особенности

### 1. Формат даты
- Поддерживается только формат "DD.MM.YYYY"
- Дни и месяцы < 10 могут указываться без ведущего нуля
- Годы должны быть четырехзначными

### 2. Обработка ошибок
- Некорректные даты вызывают `ValueError`
- Пустые строки возвращают объекты с полем "error"
- Недопустимые символы в именах игнорируются

### 3. Языковая поддержка
- Поддерживается русский и латинский алфавиты
- Числовые значения букв соответствуют традиционной нумерологической системе
- Регистр букв не влияет на расчеты


